openapi: 3.0.3
info:
  title: Semantic Actions API
  version: "0.1.0"
servers:
  - url: https://api.example.com
paths:
  /action-types:
    get:
      summary: List action types and attribute definitions
      responses:
        '200':
          description: Action type catalog
          content:
            application/json:
              schema:
                type: object
                properties:
                  version:
                    type: string
                  items:
                    type: array
                    items:
                      $ref: '#/components/schemas/ActionType'
  /action-types/{key}:
    get:
      summary: Get a specific action type definition
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Action type definition
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ActionType'
        '404':
          description: Not found
  /actions:
    get:
      summary: List actions
      parameters:
        - in: query
          name: type
          schema:
            type: string
            description: Filter by action type key
      responses:
        '200':
          description: Action list
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Action'
    post:
      summary: Create an action
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActionCreate'
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Action'
        '400':
          description: Validation failed
  /actions/{id}:
    get:
      summary: Get an action
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Action
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Action'
        '404':
          description: Not found
    put:
      summary: Update an action
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActionUpdate'
      responses:
        '200':
          description: Updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Action'
        '400':
          description: Validation failed
        '404':
          description: Not found
  /actions/{id}/duplicate:
    post:
      summary: Duplicate an existing action
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '201':
          description: Duplicated action
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Action'
        '404':
          description: Not found
  /actions/validate:
    post:
      summary: Validate an action payload without persisting
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ActionCreate'
      responses:
        '200':
          description: Validation result
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationResult'
        '400':
          description: Invalid request
components:
  schemas:
    ActionType:
      type: object
      required: [key, displayName, version, attributeDefinitions]
      properties:
        key:
          type: string
        displayName:
          type: string
        description:
          type: string
        version:
          type: string
        attributeDefinitions:
          type: array
          items:
            $ref: '#/components/schemas/AttributeDefinition'
    AttributeDefinition:
      type: object
      required: [key, label, dataType]
      properties:
        key:
          type: string
        label:
          type: string
        dataType:
          type: string
          enum: [string, number, boolean, enum]
        required:
          type: boolean
          default: false
        constraints:
          type: object
          properties:
            min:
              type: number
            max:
              type: number
            pattern:
              type: string
            allowedValues:
              type: array
              items:
                type: string
            defaultValue:
              nullable: true
        helpText:
          type: string
    Action:
      type: object
      required: [id, name, type, attributes]
      properties:
        id:
          type: string
        name:
          type: string
        type:
          type: string
        attributes:
          type: object
          additionalProperties: true
        validationStatus:
          type: string
          enum: [valid, invalid]
        validationMessages:
          type: array
          items:
            $ref: '#/components/schemas/ValidationMessage'
        createdBy:
          type: string
        updatedBy:
          type: string
        updatedAt:
          type: string
          format: date-time
    ActionCreate:
      type: object
      required: [name, type, attributes]
      properties:
        name:
          type: string
        type:
          type: string
        attributes:
          type: object
          additionalProperties: true
    ActionUpdate:
      allOf:
        - $ref: '#/components/schemas/ActionCreate'
      required: [name, type, attributes]
    ValidationResult:
      type: object
      properties:
        status:
          type: string
          enum: [valid, invalid]
        messages:
          type: array
          items:
            $ref: '#/components/schemas/ValidationMessage'
    ValidationMessage:
      type: object
      required: [field, message]
      properties:
        field:
          type: string
        severity:
          type: string
          enum: [error, warning]
        message:
          type: string
