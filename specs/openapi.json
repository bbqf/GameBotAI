{
  "openapi": "3.0.4",
  "info": {
    "title": "GameBot.Service",
    "version": "1.0"
  },
  "paths": {
    "/actions": {
      "post": {
        "tags": [
          "Actions"
        ],
        "operationId": "CreateAction",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateActionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "get": {
        "tags": [
          "Actions"
        ],
        "operationId": "ListActions",
        "parameters": [
          {
            "name": "gameId",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/actions/{id}": {
      "get": {
        "tags": [
          "Actions"
        ],
        "operationId": "GetAction",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/commands": {
      "post": {
        "tags": [
          "Commands"
        ],
        "operationId": "CreateCommand",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateCommandRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "get": {
        "tags": [
          "Commands"
        ],
        "operationId": "ListCommands",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/commands/{id}": {
      "get": {
        "tags": [
          "Commands"
        ],
        "operationId": "GetCommand",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "patch": {
        "tags": [
          "Commands"
        ],
        "operationId": "UpdateCommand",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UpdateCommandRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "delete": {
        "tags": [
          "Commands"
        ],
        "operationId": "DeleteCommand",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/commands/{id}/force-execute": {
      "post": {
        "tags": [
          "Commands"
        ],
        "operationId": "ForceExecuteCommand",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "sessionId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/commands/{id}/evaluate-and-execute": {
      "post": {
        "tags": [
          "Commands"
        ],
        "operationId": "EvaluateAndExecuteCommand",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "sessionId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/health": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "Health",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "Root",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "CreateSession",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateSessionRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetSession",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "delete": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "StopSession",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}/device": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetSessionDevice",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}/inputs": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "SendInputs",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/InputActionsRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}/health": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetSessionHealth",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}/snapshot": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetSnapshot",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/sessions/{id}/execute-action": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "ExecuteAction",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "actionId",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/games": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "CreateGame",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CreateGameRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "ListGames",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/games/{id}": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetGame",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/adb/version": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "AdbVersion",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/adb/devices": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "AdbDevices",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/images": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "UploadImageReference",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/UploadImageRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/images/{id}": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetImageReference",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/images/detect": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "DetectImageMatches",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/DetectRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Detection results",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/DetectResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid request",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          },
          "404": {
            "description": "Reference image not found",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/Error"
                }
              }
            }
          }
        }
      }
    },
    "/metrics/triggers": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetTriggerEvaluationMetrics",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/config": {
      "get": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "GetConfiguration",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/config/refresh": {
      "post": {
        "tags": [
          "GameBot.Service"
        ],
        "operationId": "RefreshConfiguration",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/triggers": {
      "post": {
        "tags": [
          "Triggers"
        ],
        "operationId": "CreateTrigger",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TriggerCreateDto"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "get": {
        "tags": [
          "Triggers"
        ],
        "operationId": "ListTriggers",
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/triggers/{id}": {
      "get": {
        "tags": [
          "Triggers"
        ],
        "operationId": "GetTrigger",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      },
      "delete": {
        "tags": [
          "Triggers"
        ],
        "operationId": "DeleteTrigger",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    },
    "/triggers/{id}/test": {
      "post": {
        "tags": [
          "Triggers"
        ],
        "operationId": "TestTrigger",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CommandStepDto": {
        "required": [
          "targetId",
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "$ref": "#/components/schemas/CommandStepTypeDto"
          },
          "targetId": {
            "type": "string",
            "nullable": true
          },
          "order": {
            "type": "integer",
            "format": "int32"
          }
        },
        "additionalProperties": false
      },
      "CommandStepTypeDto": {
        "enum": [
          0,
          1
        ],
        "type": "integer",
        "format": "int32"
      },
      "CreateActionRequest": {
        "required": [
          "gameId",
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "gameId": {
            "type": "string",
            "nullable": true
          },
          "steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InputActionDto"
            },
            "nullable": true
          },
          "checkpoints": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "CreateCommandRequest": {
        "required": [
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "triggerId": {
            "type": "string",
            "nullable": true
          },
          "steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CommandStepDto"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "CreateGameRequest": {
        "required": [
          "name"
        ],
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "description": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "CreateSessionRequest": {
        "type": "object",
        "properties": {
          "gameId": {
            "type": "string",
            "nullable": true
          },
          "gamePath": {
            "type": "string",
            "nullable": true
          },
          "adbSerial": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "InputActionDto": {
        "required": [
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "nullable": true
          },
          "args": {
            "type": "object",
            "additionalProperties": { },
            "nullable": true
          },
          "delayMs": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "durationMs": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "InputActionsRequest": {
        "required": [
          "actions"
        ],
        "type": "object",
        "properties": {
          "actions": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/InputActionDto"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TriggerCreateDto": {
        "required": [
          "params",
          "type"
        ],
        "type": "object",
        "properties": {
          "type": {
            "minLength": 1,
            "type": "string"
          },
          "enabled": {
            "type": "boolean"
          },
          "cooldownSeconds": {
            "maximum": 2147483647,
            "minimum": 0,
            "type": "integer",
            "format": "int32"
          },
          "params": { }
        },
        "additionalProperties": false
      },
      "UpdateCommandRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "nullable": true
          },
          "triggerId": {
            "type": "string",
            "nullable": true
          },
          "steps": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/CommandStepDto"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "UploadImageRequest": {
        "required": [
          "data",
          "id"
        ],
        "type": "object",
        "properties": {
          "id": {
            "minLength": 1,
            "type": "string"
          },
          "data": {
            "minLength": 1,
            "type": "string"
          }
        },
        "additionalProperties": false
      },
      "DetectRequest": {
        "type": "object",
        "required": [
          "referenceImageId"
        ],
        "properties": {
          "referenceImageId": {
            "type": "string",
            "description": "Identifier of a previously stored reference image"
          },
          "threshold": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1,
            "default": 0.8
          },
          "maxResults": {
            "type": "integer",
            "minimum": 1,
            "maximum": 100,
            "default": 10
          },
          "overlap": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1,
            "default": 0.3
          }
        }
      },
      "DetectResponse": {
        "type": "object",
        "properties": {
          "matches": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/MatchResult"
            }
          },
          "limitsHit": {
            "type": "boolean",
            "description": "True if limited by maxResults or timeout"
          }
        }
      },
      "MatchResult": {
        "type": "object",
        "properties": {
          "bbox": {
            "$ref": "#/components/schemas/NormalizedRect"
          },
          "confidence": {
            "type": "number",
            "format": "float",
            "minimum": 0,
            "maximum": 1
          }
        }
      },
      "NormalizedRect": {
        "type": "object",
        "required": [
          "x",
          "y",
          "width",
          "height"
        ],
        "properties": {
          "x": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "y": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "width": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          },
          "height": {
            "type": "number",
            "minimum": 0,
            "maximum": 1
          }
        }
      },
      "Error": {
        "type": "object",
        "required": [
          "code",
          "message"
        ],
        "properties": {
          "code": {
            "type": "string",
            "enum": [
              "invalid_request",
              "not_found"
            ]
          },
          "message": {
            "type": "string"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Actions"
    },
    {
      "name": "Commands"
    },
    {
      "name": "GameBot.Service"
    },
    {
      "name": "Triggers"
    }
  ]
}